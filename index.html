<script>
// ... (중략)

// 버튼 클릭 이벤트 핸들러
function handleOptionClick(event) {
    const btn = event.target;
    const parent = btn.closest('.question');
    const parentId = parent.id;
    const qIndex = parseInt(parentId.replace('q', '')) - 1; // 0-based index

    // 같은 질문의 모든 버튼 비활성화
    parent.querySelectorAll('.option-button').forEach(b => b.classList.remove('active'));
    // 선택된 버튼 활성화
    btn.classList.add('active');

    // 답변 저장
    answers[qIndex] = btn.textContent;

    if (parentId === 'q4') {
        selectedRegion = btn.textContent;
        updateCityOptions(selectedRegion);
        const cityList = data.cities[selectedRegion];
        // '전역' 지역(cityList가 null)을 선택한 경우, Q5를 건너뛰고 바로 결과창으로 이동 (자동 문자)
        if (cityList === null) {
            answers[4] = selectedRegion; // Q5를 건너뛰므로, Q4의 선택값을 Q5에 저장
            showNext(true); // 바로 summarize 호출
            return;
        } else {
            answers[4] = undefined; // Q5를 진행해야 하므로 Q5 답변은 초기화
            showNext(); // Q5로 이동
            return;
        }
    }

    if (parentId === 'q5') {
        showNext(true); // 마지막 답변이므로 summarize 호출
        return;
    }

    // [수정]: Q1, Q2, Q3 (qIndex가 0, 1, 2) 선택 시 다음 질문으로 확실히 이동
    if (qIndex < 3) { 
        showNext(); // Q1, Q2, Q3 다음 질문으로 이동
        return;
    }
}

// ... (이하 showNext, summarize, showQuiz 함수 등은 그대로 유지됩니다)

</script>
